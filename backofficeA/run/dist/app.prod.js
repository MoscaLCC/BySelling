"use strict";var express=require("express"),path=require("path"),favicon=require("serve-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),methodOverride=require("method-override"),nodemailer=require("nodemailer"),app=express(),router=express.Router(),transporter=nodemailer.createTransport({service:"Gmail",auth:{user:"luismarqueslcc@gmail.com",pass:"Tita9800000"}}),mysql=require("mysql"),connection=mysql.createConnection({multipleStatements:!0,hostname:"127.0.0.1",port:"3306",user:"root",password:"root",database:"id4056546_uniline"});connection.connect(function(e){e?console.log(e):console.log("Connection established")});var perfilAdmin=require("./routes/perfilAdmin"),orderInfo=require("./routes/orderInfo"),login=require("./routes/login"),logout=require("./routes/logout"),index=require("./routes/index"),clients=require("./routes/clients"),tasks=require("./routes/tasks"),message=require("./routes/message"),services=require("./routes/services"),clientInf=require("./routes/clientInfo"),taskInf=require("./routes/taskDescription"),order=require("./routes/orders"),importar=require("./routes/deploy"),comp=require("./routes/compose"),messInf=require("./routes/messageInfo"),produto=require("./routes/produto"),createProd=require("./routes/createProd");app.set("views",path.join(__dirname,"views")),app.set("view engine","pug"),connection.query("SELECT COUNT(ID_TASK) AS tamanho FROM Task WHERE STATE=0",function(e,r,o){app.locals.missedMenu=r[0].tamanho}),connection.query("SELECT COUNT(ID_ORDER) AS ord FROM ORDEM WHERE STATUS=0",function(e,r,o){app.locals.missedOrders=r[0].ord}),connection.query("SELECT COUNT(idMESSAGES) AS mg FROM ADMIN_MESSAGE WHERE Tipo=0 and IS_READ=1",function(e,r,o){app.locals.inbox=r[0].mg}),app.locals.prettyDate=function(e){return e.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+" "+e.getFullYear()},app.locals.prettyDate2=function(e){var r=e.getDate();r<10&&(r="0"+r);var o=["01","02","03","04","05","06","07","08","09","10","11","12"][e.getMonth()];return e.getFullYear()+"-"+o+"-"+r},app.use(favicon(path.join(__dirname,"public","images","upload","favicon.ico"))),app.use(methodOverride("_method")),app.use(bodyParser.urlencoded({extended:!0})),app.use(bodyParser.urlencoded({extended:!0})),app.use(cookieParser()),app.use(express.static(path.join(__dirname,"public"))),app.use(express.static(path.join("./../../WebSiteClient/run/public"))),app.use(function(e,r,o){e.connection=connection,o()}),app.use(function(e,r,o){e.transporter=transporter,o()}),app.use("/perfilAdmin",perfilAdmin),app.use("/logout",logout),app.use("/orderInfo",orderInfo),app.use("/",login),app.use("/index",index),app.use("/clients",clients),app.use("/tasks",tasks),app.use("/messages",message),app.use("/taskDescription",taskInf),app.use("/clientInfo",clientInf),app.use("/services",services),app.use("/orders",order),app.use("/compose",comp),app.use("/importar",importar),app.use("/messageInfo",messInf),app.use("/produto",produto),app.use("/createProd",createProd),app.use(express.static(__dirname+"/public")),app.use(function(e,r,o,s){o.locals.message=e.message,o.locals.error="development"===r.app.get("env")?e:{},o.status(e.status||500),o.render("error")}),module.exports=app;