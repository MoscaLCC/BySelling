"use strict";var express=require("express"),bodyParser=require("body-parser"),router=express.Router(),cookieParser=require("cookie-parser"),formidable=require("formidable");router.get("/:orderID",function(s,c,e){var t;null==s.cookies.deploy||void 0===s.cookies.online?c.redirect("/"):(t=s.connection).query("SELECT * FROM ORDEM WHERE ID_ORDER=?",s.params.orderID,function(e,o){var i=o[0];t.query("SELECT * FROM ORDER_PRODUCT WHERE ID_ORDER=?",s.params.orderID,function(e,o){var r=o[0];t.query("SELECT * FROM PRODUTO WHERE id_PRODUCT=?",r.id_PRODUCT,function(e,o){products=o,t.query("SELECT * FROM SIZE WHERE PRODUTO=?",r.id_PRODUCT,function(e,o){sizes=o,c.render("produto",{title:"Encomenda",ordem:i,order:r,dataProducts:products[0],dataSizes:sizes,NOME:s.cookies.nome,EMAIL:s.cookies.email,PHONE:s.cookies.phone,MORADA:s.cookies.address,SITE:s.cookies.site,FACE:s.cookies.face,TWITTER:s.cookies.twitter,NIF:s.cookies.nif,editable:!0})})})})})}),router.get("/see/:prodID",function(r,i,e){var s;null==r.cookies.deploy||void 0===r.cookies.online?i.redirect("/"):(s=r.connection).query("SELECT * FROM PRODUTO WHERE id_PRODUCT=?",r.params.prodID,function(e,o){products=o,s.query("SELECT * FROM SIZE WHERE PRODUTO=?",r.params.prodID,function(e,o){sizes=o,i.render("produto",{title:"Encomenda",dataProducts:products[0],dataSizes:sizes,NOME:r.cookies.nome,EMAIL:r.cookies.email,PHONE:r.cookies.phone,MORADA:r.cookies.address,SITE:r.cookies.site,FACE:r.cookies.face,TWITTER:r.cookies.twitter,NIF:r.cookies.nif,editable:!1})})})}),router.get("/delete/:prodID",function(r,s,e){var c;null==r.cookies.deploy||void 0===r.cookies.online?s.redirect("/"):(c=r.connection).query("UPDATE PRODUTO set isActive = 0 WHERE id_PRODUCT=?",r.params.prodID,function(e,o){c.query("DELETE FROM SIZE WHERE PRODUTO=?",r.params.prodID,function(e,o){c.query("SELECT ID_ORDER FROM ORDER_PRODUCT WHERE id_PRODUCT=?",r.params.prodID,function(e,o){var r=o;console.log(JSON.stringify(r));var i="";for(elem in r)console.log(elem),i=i+"UPDATE ORDEM set STATUS = 2 where ID_ORDER="+r[elem].ID_ORDER+" AND STATUS < 2; \n";console.log(i),c.query(i,function(e,o){s.redirect("/services")})})})})}),module.exports=router;