"use strict";var express=require("express"),router=express.Router();router.get("/",function(n,s,e){if(void 0===n.cookies.deploy)s.redirect("/");else if(void 0===n.cookies.online)s.redirect("/");else{var r=n.connection;r.query("SELECT COUNT(idMESSAGES) AS mg FROM ADMIN_MESSAGE WHERE Tipo=0 and IS_READ=1",function(e,o,i){n.app.locals.inbox=o[0].mg,r.query("SELECT COUNT(ID_ORDER) AS ord FROM ORDEM WHERE STATUS=0",function(e,o,i){n.app.locals.missedOrders=o[0].ord,r.query("SELECT COUNT(ID_TASK) AS tamanho FROM Task WHERE STATE=0",function(e,o,i){n.app.locals.missedMenu=o[0].tamanho,r.query("SELECT * FROM ADMINISTRATOR WHERE Username=?",n.cookies.online,function(e,o,i){var r=o[0];s.render("perfilAdmin",{title:"Administrador",mail:n.cookies.email,nome:n.cookies.nome,ADDRESS:n.cookies.address,PHONE:n.cookies.phone,SITE:n.cookies.site,FACE:n.cookies.face,TWITTER:n.cookies.twitter,NIF:n.cookies.nif,ADMIN:r})})})})})}}),router.post("/update",function(r,n,e){var s=r.connection;params1=[r.body.user,r.body.pass,r.cookies.online],params2=[r.body.nome,r.body.email,r.body.phone,r.body.address,r.body.site,r.body.face,r.body.twitter,r.body.nif,r.body.nif],console.log(params1),console.log(params2),s.query("Update DEPLOY SET NAME=?, EMAIL=?, PHONE=?, ADRESS=?, WEBPAGE_LINK=?, FACEBOOK_LINK=?, TWITTER_LINK=?, NIF=? WHERE EMAIL=?",params2,function(e,o,i){s.query("Update ADMINISTRATOR SET Username=?, PASSWORD=? WHERE Username=?",params1,function(e,o,i){n.clearCookie("online"),n.clearCookie("nome"),n.clearCookie("address"),n.clearCookie("phone"),n.clearCookie("site"),n.clearCookie("face"),n.clearCookie("twitter"),n.clearCookie("nif"),n.cookie("online",r.body.user),n.cookie("nome",r.body.nome),n.cookie("address",r.body.email),n.cookie("phone",r.body.phone),n.cookie("site",r.body.address),n.cookie("face",r.body.face),n.cookie("twitter",r.body.twitter),n.cookie("nif",r.body.nif),console.log("teste"+r.cookies.online),n.redirect("/perfilAdmin")})})}),module.exports=router;