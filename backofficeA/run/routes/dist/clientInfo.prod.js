"use strict";var express=require("express"),router=express.Router();router.get("/:userID",function(o,n,e){var i=o.connection;void 0===o.cookies.deploy?n.redirect("/"):void 0===o.cookies.online?n.redirect("/"):i.query("SELECT COUNT(idMESSAGES) AS mg FROM ADMIN_MESSAGE WHERE Tipo=0 and IS_READ=1",function(e,E,r){o.app.locals.inbox=E[0].mg,i.query("SELECT COUNT(ID_ORDER) AS ord FROM ORDEM WHERE STATUS=0",function(e,E,r){o.app.locals.missedOrders=E[0].ord,i.query("SELECT COUNT(ID_TASK) AS tamanho FROM Task WHERE STATE=0",function(e,E,r){o.app.locals.missedMenu=E[0].tamanho,i.query("SELECT * FROM CLIENT WHERE EMAIL=?",o.params.userID,function(e,E,r){userInfo=E,i.query("SELECT * FROM `ORDEM` WHERE Client_NIF= ?",o.params.userID,function(e,E,r){numeroEncomendas=E,i.query("SELECT BEGIN_DATE FROM `ORDEM` WHERE Client_NIF =? ORDER BY BEGIN_DATE LIMIT 1",o.params.userID,function(e,E,r){ultimaEncomenda=E,n.render("clientInfo",{title:"ClientInfo",user:userInfo,nOrder:numeroEncomendas,uOrder:ultimaEncomenda,mail:o.cookies.email,nome:o.cookies.nome})})})})})})})}),router.post("/:id",function(o,n){if(void 0===o.cookies.deploy)n.redirect("/");else if(void 0===o.cookies.online)n.redirect("/");else{var i=o.connection;i.query("SELECT IS_BLOCKED FROM CLIENT WHERE EMAIL=?",o.params.id,function(e,E,r){0==E[0].IS_BLOCKED?i.query("UPDATE CLIENT SET IS_BLOCKED=1 WHERE EMAIL=?",o.params.id,function(e,E,r){n.redirect("back")}):i.query("UPDATE CLIENT SET IS_BLOCKED=0 WHERE EMAIL=?",o.params.id,function(e,E,r){n.redirect("back")})})}}),module.exports=router;