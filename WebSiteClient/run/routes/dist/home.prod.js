"use strict";var express=require("express"),router=express.Router();router.get("/",function(r,n,e){if(null==r.cookies.deploy)n.redirect("/indisponivel");else if(void 0===r.cookies.onlineC)n.redirect("/signin");else{var o=r.cookies.onlineC;r.connection.query('SELECT * FROM ORDEM WHERE client_NIF ="'+o+'"',function(e,o){e?console.log("Ocorreu um erro ao carregar a pagina home"):n.render("home",{title:"Home",encomendas:o,NOME:r.cookies.nome,EMAIL:r.cookies.email,PHONE:r.cookies.phone,MORADA:r.cookies.address,SITE:r.cookies.site,FACE:r.cookies.face,TWITTER:r.cookies.twitter,NIF:r.cookies.nif})})}}),router.get("/alterar/:orderID",function(s,a,e){var o=s.cookies.onlineC;if(null==s.cookies.deploy)a.redirect("/indisponivel");else if(void 0===s.cookies.onlineC)a.redirect("/signin");else{var r=s.connection,n=[o,s.params.orderID];r.query("INSERT INTO Task (DESCRIPTION, STATE, Client_NIF, Tipo, dataPedido, Ordem_ID) VALUES('O cliente com o NIF="+o+"pretende alterar a encomenda "+s.params.orderID+"',0,?,2,CURDATE(),?)",n,function(e,o,r){var n=s.transporter,i={from:s.cookies.email,to:s.cookies.email,subject:"Nova Tarefa",text:"Possui uma nova tarefa relativa à alteração de uma encomenda"};n.sendMail(i,function(e,o){e?(console.log(e),a.json({yo:"error"})):(console.log("Message sent: "+o.response),a.json({yo:o.response}))}),a.redirect("/home")})}}),router.get("/cancelar/:orderID",function(s,a,e){var o=s.cookies.onlineC;if(null==s.cookies.deploy)a.redirect("/indisponivel");else if(void 0===s.cookies.onlineC)a.redirect("/signin");else{var r=s.connection,n=[o,s.params.orderID];r.query("INSERT INTO Task (DESCRIPTION, STATE, Client_NIF, Tipo, dataPedido, Ordem_ID) VALUES('O cliente com o NIF= "+o+"pretende cancelar a encomenda "+s.params.orderID+"',0,?,1,CURDATE(),?)",n,function(e,o,r){var n=s.transporter,i={from:s.cookies.email,to:s.cookies.email,subject:"Nova Tarefa",text:"Possui uma nova tarefa relativa ao cancelamento de uma encomenda"};n.sendMail(i,function(e,o){e?(console.log(e),a.json({yo:"error"})):(console.log("Message sent: "+o.response),a.json({yo:o.response}))}),a.redirect("/home")})}}),module.exports=router;