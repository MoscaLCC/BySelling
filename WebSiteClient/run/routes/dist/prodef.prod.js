"use strict";var express=require("express"),bodyParser=require("body-parser"),router=express.Router(),cookieParser=require("cookie-parser"),formidable=require("formidable");router.get("/",function(i,r,e){if(null==i.cookies.deploy)r.redirect("/indisponivel");else if(void 0===i.cookies.onlineC)r.redirect("/signin");else{i.connection.query("SELECT * FROM PRODUTO WHERE isActive = 1 ORDER BY NAME",function(e,o){products=o,console.log(JSON.stringify(products)),r.render("prodef",{title:"Encomenda",dataProducts:products,NOME:i.cookies.nome,EMAIL:i.cookies.email,PHONE:i.cookies.phone,MORADA:i.cookies.address,SITE:i.cookies.site,FACE:i.cookies.face,TWITTER:i.cookies.twitter,NIF:i.cookies.nif})})}}),router.post("/",function(s,t,e){if(null==s.cookies.deploy)t.redirect("/indisponivel");else if(void 0===s.cookies.onlineC)t.redirect("/signin");else{var c=s.connection;(new formidable.IncomingForm).parse(s,function(e,n,o){var i=new Date;i.addDays(5);var r=[s.cookies.onlineC,i,n.nameproduto];c.query('INSERT INTO `id4056546_uniline`.`ordem` (`BEGIN_DATE`, `CLOSE_DATE`, `Client_NIF`, `ASKED_DELIVERY_DATE`, `STATUS`, `PRODUTO`, `TRACKING`) VALUES (CURDATE(),null,?,?,0,?,"")',r,function(e,o,i){c.query("SELECT MAX(ID_ORDER) as max FROM ORDEM",function(e,o,i){var r=o[0].max;c.query("INSERT INTO ORDER_PRODUCT (ID_ORDER, id_PRODUCT, opcao_valor, insertionDate) VALUES("+r+","+n.idproduto+',"'+n.size+"_"+n.quant+'",curdate());',function(e,o,i){console.log(o),console.log(e),t.redirect("/home")})})})})}}),Date.prototype.addDays=function(e){return this.setDate(this.getDate()+parseInt(e)),this},module.exports=router;